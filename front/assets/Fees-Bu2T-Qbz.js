import{e as ie,b as I,az as O,aA as S,aB as G,d as v,S as ge,aC as H,W as F,r as u,aD as pe,j as e,aE as fe,ah as Z,aF as ee,B as A,aG as te,a0 as se,aH as ae,aI as ne,aJ as re,K as De}from"./index-CAbGq19O.js";import{F as he}from"./FailedRequest-kw7mU4Mw.js";const _e="_subtitle_1uifh_1",xe="_updateDateBox_1uifh_15",Fe="_actionBox_1uifh_23",je="_feesWrapper_1uifh_43",me="_fundSubtitle_1uifh_51",Ee="_feesInputs_1uifh_65",be="_updateDateButton_1uifh_103",d={subtitle:_e,updateDateBox:xe,actionBox:Fe,feesWrapper:je,fundSubtitle:me,feesInputs:Ee,updateDateButton:be},Se=()=>{const{can:a}=ie(),{response:s,error:c,loading:p,loaded:f,execute:_}=I("fees/list",a(O)),{response:r,error:n,loading:i,loaded:o,execute:t}=I("fees/fines-date",a(S)),{response:l,error:D,loading:x,loaded:w,execute:C}=I("fees/re-registration-date",a(S)),{response:m,error:E,loading:N,loaded:U,execute:P}=I("fees/detailed-prints",a(G)),L=c&&c.response.status!==403||n&&n.response.status!==403||D&&D.response.status!==403||E&&E.response.status!==403,R=p||i||x||N,B=(f||!a(O))&&(o||!a(S))&&(w||!a(S))&&(U||!a(G));return{getData:()=>{P(),_(),t(),C()},getFees:_,getFinesDate:t,getReregistrationDate:C,getPrintings:P,error:L,loading:R,loaded:B,feesResponse:s,finesDateResponse:r,reregistrationDateResponse:l,printingsResponse:m}},ve=a=>{const{language:s}=v(),{fees:c}=s,{execute:p,loading:f}=ge("fees/update-values");return{handleUpdateFees:async r=>{var n,i,o;try{const t=Object.values(r).flatMap(l=>l);await p(void 0,t),a(),F("success",c.updated_fees_successfully,"")}catch(t){F("error",s.toast.an_error_occurred,((o=(i=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:i.details)==null?void 0:o[0])||"")}},loading:f}},Ce=a=>{const{language:s}=v(),{fees:c}=s,{execute:p,loading:f}=H("fees/fines-date");return{handleUpdateFinesDate:async r=>{var n,i,o;try{await p(void 0,{finesDate:r==null?void 0:r.toString()}),a(),F("success",c.updated_fines_date_successfully,"")}catch(t){F("error",s.toast.an_error_occurred,((o=(i=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:i.details)==null?void 0:o[0])||"")}},loading:f}},Ne=a=>{const{language:s}=v(),{fees:c}=s,{execute:p,loading:f}=H("fees/re-registration-date");return{handleUpdateReregistrationDate:async r=>{var n,i,o;try{await p(void 0,{reregistrationDate:r==null?void 0:r.toString()}),a(),F("success",c.updated_re_registration_successfully,"")}catch(t){F("error",s.toast.an_error_occurred,((o=(i=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:i.details)==null?void 0:o[0])||"")}},loading:f}},Ue=a=>{const{language:s}=v(),{fees:c}=s,{execute:p,loading:f}=H("fees/detailed-prints");return{handleUpdatePrintings:async r=>{var n,i,o;try{await p(void 0,r),a(),F("success",c.updated_printings_successfully,"")}catch(t){F("error",s.toast.an_error_occurred,((o=(i=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:i.details)==null?void 0:o[0])||"")}},loading:f}};function Be(){const{language:{fees:a}}=v(),{can:s}=ie(),{getData:c,getFees:p,getFinesDate:f,getReregistrationDate:_,getPrintings:r,error:n,loading:i,loaded:o,feesResponse:t,finesDateResponse:l,reregistrationDateResponse:D,printingsResponse:x}=Se(),{handleUpdateFees:w,loading:C}=ve(p),[m,E]=u.useState(t==null?void 0:t.data),[N,U]=u.useState(!1);u.useEffect(()=>{t&&E(t.data),U(!1)},[t]);const{handleUpdateFinesDate:P,loading:L}=Ce(f),[R,B]=u.useState(new Date((l==null?void 0:l.data.finesDate)||"")),[T,M]=u.useState(!1);u.useEffect(()=>{l&&B(new Date(l==null?void 0:l.data.finesDate)),M(!1)},[l]);const{handleUpdateReregistrationDate:oe,loading:de}=Ne(_),[q,z]=u.useState(new Date((D==null?void 0:D.data.reregistrationDate)||"")),[J,K]=u.useState(!1);u.useEffect(()=>{D&&z(new Date(D.data.reregistrationDate)),K(!1)},[D]);const{handleUpdatePrintings:ue,loading:ce}=Ue(r),[W,X]=u.useState(x==null?void 0:x.data),[$,Q]=u.useState(!1);u.useEffect(()=>{x&&X(x.data),Q(!1)},[x]);const{setHasUnsavedChanges:le}=pe();return u.useEffect(()=>{le(N||T||J||$)},[N,T,J,$]),n?e.jsx(he,{action:c}):!o&&i?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[s(S)&&e.jsxs("div",{className:d.feesInputs,children:[e.jsxs("div",{className:d.updateDateBox,children:[e.jsxs("span",{className:d.subtitle,children:[a.fines_date," :"]}),e.jsxs("div",{className:d.actionBox,children:[e.jsx(Z,{value:R,onChange:g=>{M(!0),B(g.value)},disabled:!s(ee)}),s(ee)&&e.jsx(A,{onClick:()=>{P(R)},label:a.update_fines,loading:L,className:d.updateDateButton,outlined:!0})]})]}),e.jsxs("div",{className:d.updateDateBox,children:[e.jsxs("span",{className:d.subtitle,children:[a.re_registration_date," :"]}),e.jsxs("div",{className:d.actionBox,children:[e.jsx(Z,{value:q,onChange:g=>{K(!0),z(g.value)},disabled:!s(te)}),s(te)&&e.jsx(A,{onClick:()=>{oe(q)},label:a.update_re_registration,loading:de,className:d.updateDateButton,outlined:!0})]})]})]}),s(G)&&e.jsxs("div",{className:`${d.feesWrapper}`,children:[e.jsxs("span",{className:d.fundSubtitle,children:[a.printings," :"]}),e.jsxs("div",{className:d.feesInputs,children:[Object.entries(W).map(([g,V],k)=>e.jsxs(se,{children:[e.jsx(ae,{value:W[g]||0,onChange:j=>{Q(!0),X(h=>h&&{...h,[g]:j.value||0})},min:0,disabled:!s(ne)}),e.jsx("label",{children:g})]},k)),s(ne)&&e.jsx(A,{onClick:()=>{ue(W)},label:a.update_printings,loading:ce,outlined:!0})]})]}),s(O)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:d.feesWrapper,children:m&&Object.entries(m).map(([g,V])=>{const k=(j,h)=>{U(!0),E(b=>{if(!b)return b;const y=b;if(y&&y[g]){const Y=y[g];Y[h]={...Y[h],value:j||0}}return{...y}})};return e.jsxs("div",{children:[e.jsxs("span",{className:d.fundSubtitle,children:[g," :"]}),e.jsx("div",{className:d.feesInputs,children:V.map((j,h)=>e.jsxs(se,{children:[e.jsx(ae,{value:j.value,onChange:b=>k(b.value,h),min:0,disabled:!s(re)}),e.jsx("label",{children:j.name})]},j.name+h))})]},g)})}),s(re)&&e.jsxs(e.Fragment,{children:[e.jsx(De,{}),e.jsx(A,{onClick:()=>{w(m)},label:a.update_fees,loading:C,className:"button-align-end",outlined:!0})]})]})]})}export{Be as default};
